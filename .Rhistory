ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
guides(fill = FALSE) +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgadoe') +
ylab('Proporção de processos por assunto') +
theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = .5))
d_cjsg %>%
separate(classe_assunto, c('classe', 'assunto'), sep = ' / ',
extra = 'merge', fill = 'right') %>%
count(orgao_julgador, assunto) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup %>%
filter(ntot > 1000) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
guides(fill = FALSE) +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto')
d_cjsg %>%
separate(classe_assunto, c('classe', 'assunto'), sep = ' / ',
extra = 'merge', fill = 'right') %>%
group_by(assunto) %>%
mutate(n_assunto = n()) %>%
ungroup() %>%
mutate(assunto = ifelse(n_assunto < 100, 'Outro', assunto)) %>%
count(orgao_julgador, assunto) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup %>%
filter(ntot > 1000) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto')
d_cjsg %>%
separate(classe_assunto, c('classe', 'assunto'), sep = ' / ',
extra = 'merge', fill = 'right') %>%
group_by(assunto) %>%
mutate(n_assunto = n()) %>%
ungroup() %>%
mutate(assunto = ifelse(n_assunto < 1000, 'Outro', assunto)) %>%
count(orgao_julgador, assunto) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup %>%
filter(ntot > 1000) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto')
d_cjsg %>%
separate(classe_assunto, c('classe', 'assunto'), sep = ' / ',
extra = 'merge', fill = 'right') %>%
group_by(assunto) %>%
mutate(n_assunto = n()) %>%
ungroup() %>%
mutate(assunto = ifelse(n_assunto < 10000, 'Outro', assunto)) %>%
count(orgao_julgador, assunto) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup %>%
filter(ntot > 1000) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto')
d_cjsg %>%
separate(classe_assunto, c('classe', 'assunto'), sep = ' / ',
extra = 'merge', fill = 'right') %>%
group_by(assunto) %>%
mutate(n_assunto = n()) %>%
ungroup() %>%
mutate(assunto = ifelse(n_assunto < 5000, 'Outro', assunto)) %>%
count(orgao_julgador, assunto) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup %>%
filter(ntot > 1000) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto') +
theme(legend.position = "bottom")
d_cjsg %>%
separate(classe_assunto, c('classe', 'assunto'), sep = ' / ',
extra = 'merge', fill = 'right') %>%
group_by(assunto) %>%
mutate(n_assunto = n()) %>%
ungroup() %>%
mutate(assunto = ifelse(n_assunto < 6000, 'Outro', assunto)) %>%
count(orgao_julgador, assunto) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup %>%
filter(ntot > 1000) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto') +
theme(legend.position = "bottom")
d_cjsg %>%
separate(classe_assunto, c('classe', 'assunto'), sep = ' / ',
extra = 'merge', fill = 'right') %>%
group_by(assunto) %>%
mutate(n_assunto = n()) %>%
ungroup() %>%
mutate(assunto = ifelse(n_assunto < 7000, 'Outro', assunto)) %>%
count(orgao_julgador, assunto) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup %>%
filter(ntot > 1000) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto') +
theme(legend.position = "bottom")
d_cjsg %>%
separate(classe_assunto, c('classe', 'assunto'), sep = ' / ',
extra = 'merge', fill = 'right') %>%
group_by(assunto) %>%
mutate(n_assunto = n()) %>%
ungroup() %>%
mutate(assunto = ifelse(n_assunto < 8000, 'Outro', assunto)) %>%
count(orgao_julgador, assunto) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup %>%
filter(ntot > 1000) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto') +
theme(legend.position = "bottom")
d_cjsg %>%
separate(classe_assunto, c('classe', 'assunto'), sep = ' / ',
extra = 'merge', fill = 'right') %>%
group_by(assunto) %>%
mutate(n_assunto = n()) %>%
ungroup() %>%
mutate(assunto = ifelse(n_assunto < 9000, 'Outro', assunto)) %>%
count(orgao_julgador, assunto) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup %>%
filter(ntot > 1000) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto') +
theme(legend.position = "bottom")
d_cjsg %>%
separate(classe_assunto, c('classe', 'assunto'), sep = ' / ',
extra = 'merge', fill = 'right') %>%
group_by(assunto) %>%
mutate(n_assunto = n()) %>%
ungroup() %>%
mutate(assunto = ifelse(n_assunto < 10000, 'Outro', assunto)) %>%
count(orgao_julgador, assunto) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup %>%
filter(ntot > 1000) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto') +
theme(legend.position = "bottom")
d_cjsg %>%
separate(classe_assunto, c('classe', 'assunto'), sep = ' / ',
extra = 'merge', fill = 'right') %>%
group_by(assunto) %>%
mutate(n_assunto = n()) %>%
ungroup() %>%
mutate(assunto = ifelse(n_assunto < 5000, 'Outro', assunto)) %>%
count(orgao_julgador, assunto) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup %>%
filter(ntot > 1000) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto') +
theme(legend.position = "bottom")
d_cjsg
d_decisoes
d_decisoes
decisoes_cposg_um <- function(arq) {
html <- xml2::read_html(arq, encoding = 'UTF-8')
xpath <- '(//table[@width="98%" and @align="center"])[last()]'
r <- rvest::html_node(html, xpath = xpath)
tab <- rvest::html_table(r)
names(tab) <- c('data', 'situacao', 'decisao')
tab$result <- 'OK'
return(tab)
}
decisoes_cposg <- function(arqs, verbose = FALSE) {
abjutils::dvec(decisao_cposg_um, arqs, verbose = verbose) %>%
dplyr::rename(arq = item)
}
arqs <- dir('data-raw/cposg', full.names = TRUE)
d_decisoes <- decisoes_cposg(arqs)
saveRDS(d_decisoes, 'data-raw/d_decisoes.rds')
decisoes <- d_decisoes %>%
d_decisoes
d_decisoes %>%
filter(situacao == 'julgado') %>%
distinct(arq, decisao)
d_decisoes %>%
filter(situacao == 'Julgado') %>%
distinct(arq, decisao)
d_partes
d_partes %>% count(tipo)
d_partes %>%
filter(tipo == 'apelado', str_detect(nome, '[Mm]inist'))
partes_apelacoes <- d_partes %>%
filter(tipo == 'apelado', str_detect(nome, '[Mm]inist')) %>%
mutate(n_processo = str_replace_all(arq, '[^0-9]', ''))
partes_apelacoes
d_partes %>%
filter(tipo == 'apelado', str_detect(nome, '[Mm]inist')) %>%
mutate(n_processo = str_replace_all(arq, '[^0-9]', '')) %>%
select(n_processo)
d_decisoes
decisoes <- d_decisoes %>%
mutate(n_processo = str_replace_all(arq, '[^0-9]', '')) %>%
semi_join(partes_apelacoes, 'n_processo') %>%
filter(situacao == 'Julgado') %>%
distinct(arq, decisao) %>%
mutate(tipo_decisao = tipos_decisao(decisao))
tipos_decisao <- function(decisoes) {
ifelse(
str_detect(decisoes, negaram), 'negado', ifelse(
str_detect(decisoes, parcial), 'parcial', ifelse(
str_detect(decisoes, deram), 'provido', 'outros'
))
)
}
decisoes <- d_decisoes %>%
mutate(n_processo = str_replace_all(arq, '[^0-9]', '')) %>%
semi_join(partes_apelacoes, 'n_processo') %>%
filter(situacao == 'Julgado') %>%
distinct(arq, decisao) %>%
mutate(tipo_decisao = tipos_decisao(decisao))
decisoes
decisoes <- d_decisoes %>%
mutate(n_processo = str_replace_all(arq, '[^0-9]', '')) %>%
semi_join(partes_apelacoes, 'n_processo') %>%
filter(situacao == 'Julgado') %>%
distinct(n_processo, decisao) %>%
mutate(tipo_decisao = tipos_decisao(decisao)) %>%
select(n_processo, decisao)
decisoes
d_final %>%
mutate(data = as.Date(data, origin = '1970-01-01')) %>%
mutate(ano_mes = floor_date(data, 'month')) %>%
filter(year(data) < 2015)
d_cjsg
aux <- d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo')
aux
aux <- d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo') %>%
mutate(data = as.Date(data, origin = '1970-01-01')) %>%
mutate(ano_mes = floor_date(data, 'month')) %>%
filter(year(data) < 2015)
d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo') %>%
mutate(data = dmy(data_julgamento))
aux <- d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo') %>%
mutate(data = dmy(data_julgamento)) %>%
mutate(ano_mes = floor_date(data, 'month'))
aux
aux %>%
count(ano_mes, tipo_decisao) %>%
mutate(prop = n/sum(n)) %>%
ungroup %>%
ggplot(aes(x = ano_mes, y = prop, colour = tipo_decisao)) +
geom_line() +
geom_text(aes(y = 0.65, label = n, colour = NULL),
data = count(aux, ano_mes)) +
scale_x_date(breaks = scales::date_breaks('1 month'),
labels = scales::date_format("%b")) +
scale_y_continuous(labels = scales::percent) +
xlab('Tempo (meses)') +
ylab('Proporção de cada tipo de decisão') +
theme_bw()
aux <- d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo') %>%
mutate(data = dmy(data_julgamento)) %>%
mutate(ano_mes = floor_date(data, 'month'))
aux
decisoes
decisoes <- d_decisoes %>%
mutate(n_processo = str_replace_all(arq, '[^0-9]', '')) %>%
semi_join(partes_apelacoes, 'n_processo') %>%
filter(situacao == 'Julgado') %>%
distinct(n_processo, decisao) %>%
mutate(tipo_decisao = tipos_decisao(decisao)) %>%
select(n_processo, tipo_decisao)
aux <- d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo') %>%
mutate(data = dmy(data_julgamento)) %>%
mutate(ano_mes = floor_date(data, 'month'))
aux
aux %>%
count(ano_mes, tipo_decisao) %>%
mutate(prop = n/sum(n)) %>%
ungroup %>%
ggplot(aes(x = ano_mes, y = prop, colour = tipo_decisao)) +
geom_line() +
geom_text(aes(y = 0.65, label = n, colour = NULL),
data = count(aux, ano_mes)) +
scale_x_date(breaks = scales::date_breaks('1 month'),
labels = scales::date_format("%b")) +
scale_y_continuous(labels = scales::percent) +
xlab('Tempo (meses)') +
ylab('Proporção de cada tipo de decisão') +
theme_bw()
d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo')
count(orgao_julgador, tipo_decisao) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup() %>%
filter(ntot > 10)
d_cjsg
d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo')
count(orgao_julgador, tipo_decisao) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup()
d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo') %>%
count(orgao_julgador, tipo_decisao) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup() %>%
filter(ntot > 10)
d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo') %>%
count(orgao_julgador, tipo_decisao) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup() %>%
filter(ntot > 10) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = assunto, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por assunto') +
theme(legend.position = "bottom")
d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo') %>%
count(orgao_julgador, tipo_decisao) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup() %>%
filter(ntot > 10) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = tipo_decisao, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por tipo de decisão') +
theme(legend.position = "bottom")
d_cjsg %>%
mutate(n_processo = str_replace_all(n_processo, '[^0-9]', '')) %>%
inner_join(decisoes, 'n_processo') %>%
count(orgao_julgador, tipo_decisao) %>%
mutate(ntot = sum(n), prop = n / ntot) %>%
ungroup() %>%
filter(ntot > 10) %>%
mutate(num = extract_numeric(orgao_julgador),
num = sprintf('%02d', num)) %>%
mutate(extra = str_detect(orgao_julgador, 'Extra'),
extra = ifelse(extra, 'Câmara Extraordinária',
'Câmara de Direito Criminal')) %>%
ggplot(aes(x = num, fill = tipo_decisao, y = prop)) +
geom_bar(stat = 'identity', colour = 'black') +
facet_wrap(~extra, scales = 'free_x') +
theme_bw() +
scale_y_continuous(labels = scales::percent) +
xlab('Órgão julgador') +
ylab('Proporção de processos por tipo de decisão') +
guide_legend(label = 'Decisão') +
theme(legend.position = "bottom")
install.packages('nor1mix')
sorteia_preferencias <- function(n_pretendentes, distribuicao = c(0.1478,0.1833,0.1974,0.1879,0.1056,0.0981,0.0362,0.0176,0.0095,0.0032,0.0066,0.0015,0.0020,0.0007,0.0005,0.0006,0.0003,0.0012)){
sapply(runif(n_pretendentes), function(x){which.max(x < distribuicao)-1})
}
sorteia_preferencias
K <- 100
P <- 3.52*K
p <- c(p, sorteia_preferencias(P))
p <- NULL
p <- c(p, sorteia_preferencias(P))
distr <- c(0.1478,0.1833,0.1974,0.1879,0.1056,0.0981,0.0362,
0.0176,0.0095,0.0032,0.0066,0.0015,0.0020,0.0007,
0.0005,0.0006,0.0003,0.0012)
sorteia_preferencias <- function(n_pretendentes, distribuicao = distr){
sapply(runif(n_pretendentes), function(x){which.max(x < distribuicao)-1})
}
library(ggplot2)
bookdown::pdf_book()
bookdown::pdf_book()
rmarkdown::render_site(output_format = 'bookdown::pdf_book')
rmarkdown::render_site(output_format = 'bookdown::pdf_book')
rmarkdown::render_site(output_format = 'bookdown::gitbook')

<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Curso de Jurimetria</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Curso de Jurimetria dado ao TSE nos dias 08, 09 e 10 de agosto de 2016.">
  <meta name="generator" content="bookdown 0.1.3 and GitBook 2.6.7">

  <meta property="og:title" content="Curso de Jurimetria" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Curso de Jurimetria dado ao TSE nos dias 08, 09 e 10 de agosto de 2016." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Curso de Jurimetria" />
  
  <meta name="twitter:description" content="Curso de Jurimetria dado ao TSE nos dias 08, 09 e 10 de agosto de 2016." />
  

<meta name="author" content="Associação Brasileira de Jurimetria">

<meta name="date" content="2016-08-04">


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="web-scraping.html">
<link rel="next" href="coletar-processos.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Curso de Jurimetria</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introdução</a><ul>
<li class="chapter" data-level="1.1" data-path="definicao-de-jurimetria.html"><a href="definicao-de-jurimetria.html"><i class="fa fa-check"></i><b>1.1</b> Definição de Jurimetria</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ferramental-de-trabalho-da-abj.html"><a href="ferramental-de-trabalho-da-abj.html"><i class="fa fa-check"></i><b>2</b> Ferramental de trabalho da ABJ</a><ul>
<li class="chapter" data-level="2.1" data-path="exemplos-trabalhados.html"><a href="exemplos-trabalhados.html"><i class="fa fa-check"></i><b>2.1</b> Exemplos trabalhados</a><ul>
<li class="chapter" data-level="2.1.1" data-path="exemplos-trabalhados.html"><a href="exemplos-trabalhados.html#camaras-de-gas"><i class="fa fa-check"></i><b>2.1.1</b> Câmaras de gás</a></li>
<li class="chapter" data-level="2.1.2" data-path="exemplos-trabalhados.html"><a href="exemplos-trabalhados.html#waze-do-judiciario"><i class="fa fa-check"></i><b>2.1.2</b> Waze do Judiciário</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="pipe.html"><a href="pipe.html"><i class="fa fa-check"></i><b>2.2</b> Pipe</a></li>
<li class="chapter" data-level="2.3" data-path="data-tidying.html"><a href="data-tidying.html"><i class="fa fa-check"></i><b>2.3</b> Data tidying</a></li>
<li class="chapter" data-level="2.4" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html"><i class="fa fa-check"></i><b>2.4</b> Pacotes <code>dplyr</code> e <code>tidyr</code></a><ul>
<li class="chapter" data-level="2.4.1" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#trabalhando-com-tibbles"><i class="fa fa-check"></i><b>2.4.1</b> Trabalhando com tibbles</a></li>
<li class="chapter" data-level="2.4.2" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#as-cinco-funcoes-principais-do-dplyr"><i class="fa fa-check"></i><b>2.4.2</b> As cinco funções principais do dplyr</a></li>
<li class="chapter" data-level="2.4.3" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#caracteristicas"><i class="fa fa-check"></i><b>2.4.3</b> Características</a></li>
<li class="chapter" data-level="2.4.4" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#vantagens"><i class="fa fa-check"></i><b>2.4.4</b> Vantagens</a></li>
<li class="chapter" data-level="2.4.5" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#select"><i class="fa fa-check"></i><b>2.4.5</b> select</a></li>
<li class="chapter" data-level="2.4.6" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#filter"><i class="fa fa-check"></i><b>2.4.6</b> filter</a></li>
<li class="chapter" data-level="2.4.7" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#mutate"><i class="fa fa-check"></i><b>2.4.7</b> mutate</a></li>
<li class="chapter" data-level="2.4.8" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#arrange"><i class="fa fa-check"></i><b>2.4.8</b> arrange</a></li>
<li class="chapter" data-level="2.4.9" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#summarise"><i class="fa fa-check"></i><b>2.4.9</b> summarise</a></li>
<li class="chapter" data-level="2.4.10" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#spread"><i class="fa fa-check"></i><b>2.4.10</b> spread</a></li>
<li class="chapter" data-level="2.4.11" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#gather"><i class="fa fa-check"></i><b>2.4.11</b> gather</a></li>
<li class="chapter" data-level="2.4.12" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#funcoes-auxiliares"><i class="fa fa-check"></i><b>2.4.12</b> Funções auxiliares</a></li>
<li class="chapter" data-level="2.4.13" data-path="pacotes-dplyr-e-tidyr.html"><a href="pacotes-dplyr-e-tidyr.html#um-pouco-mais-de-manipulacao-de-dados"><i class="fa fa-check"></i><b>2.4.13</b> Um pouco mais de manipulação de dados</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="pacotes-lubridate-e-stringr.html"><a href="pacotes-lubridate-e-stringr.html"><i class="fa fa-check"></i><b>2.5</b> Pacotes <code>lubridate</code> e <code>stringr</code></a></li>
<li class="chapter" data-level="2.6" data-path="pacotes-httr-xml2-e-rvest.html"><a href="pacotes-httr-xml2-e-rvest.html"><i class="fa fa-check"></i><b>2.6</b> Pacotes <code>httr</code>, <code>xml2</code> e <code>rvest</code></a></li>
<li class="chapter" data-level="2.7" data-path="web-scraping.html"><a href="web-scraping.html"><i class="fa fa-check"></i><b>2.7</b> Web scraping</a><ul>
<li class="chapter" data-level="2.7.1" data-path="web-scraping.html"><a href="web-scraping.html#informacoes-iniciais"><i class="fa fa-check"></i><b>2.7.1</b> Informações iniciais</a></li>
<li class="chapter" data-level="2.7.2" data-path="web-scraping.html"><a href="web-scraping.html#diferenca-entre-buscar-baixar-e-processar."><i class="fa fa-check"></i><b>2.7.2</b> Diferença entre buscar, baixar e processar.</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="buscar-documentos.html"><a href="buscar-documentos.html"><i class="fa fa-check"></i><b>2.8</b> Buscar documentos</a></li>
<li class="chapter" data-level="2.9" data-path="coletar-processos.html"><a href="coletar-processos.html"><i class="fa fa-check"></i><b>2.9</b> Coletar processos</a></li>
<li class="chapter" data-level="2.10" data-path="visualizacao-de-dados.html"><a href="visualizacao-de-dados.html"><i class="fa fa-check"></i><b>2.10</b> Visualização de dados</a><ul>
<li class="chapter" data-level="2.10.1" data-path="visualizacao-de-dados.html"><a href="visualizacao-de-dados.html#instalacao"><i class="fa fa-check"></i><b>2.10.1</b> Instalação</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="construindo-graficos.html"><a href="construindo-graficos.html"><i class="fa fa-check"></i><b>2.11</b> Construindo gráficos</a><ul>
<li class="chapter" data-level="2.11.1" data-path="construindo-graficos.html"><a href="construindo-graficos.html#as-camadas-de-um-grafico"><i class="fa fa-check"></i><b>2.11.1</b> As camadas de um gráfico</a></li>
<li class="chapter" data-level="2.11.2" data-path="construindo-graficos.html"><a href="construindo-graficos.html#personalizando-os-graficos"><i class="fa fa-check"></i><b>2.11.2</b> Personalizando os gráficos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="aulas.html"><a href="aulas.html"><i class="fa fa-check"></i><b>3</b> Aulas</a></li>
<li class="chapter" data-level="4" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>4</b> Applications</a><ul>
<li class="chapter" data-level="4.1" data-path="example-one.html"><a href="example-one.html"><i class="fa fa-check"></i><b>4.1</b> Example one</a></li>
<li class="chapter" data-level="4.2" data-path="example-two.html"><a href="example-two.html"><i class="fa fa-check"></i><b>4.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>5</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Curso de Jurimetria</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="buscar-documentos" class="section level2">
<h2><span class="header-section-number">2.8</span> Buscar documentos</h2>
<p>A tarefa de listar os documentos de interesse é realizada acessando resultados de um formulário. Dependendo do site, será necessário realizar:</p>
<ul>
<li>Uma busca e uma paginação;</li>
<li>Uma busca e muitas paginações;</li>
<li>Muitas buscas e uma paginação por busca;</li>
<li>Muitas buscas e muitas paginações por busca.</li>
</ul>
<p>No TJSP temos <em>uma busca e muitas paginações</em>. Acesse a página do <a href="http://esaj.tjsp.jus.br/cjsg/consultaCompleta.do">e-SAJ</a>, digite “acordam” no campo “Pesquisa Livre” e clique em “Pesquisar”, para ter uma ideia de como é essa página.</p>
<p>A página (acessada no dia 2016-08-04) é uma ferramenta de busca com vários campos, que não permite pesquisa com dados em branco. Na parte de baixo o site mostra uma série de documentos, organizados em páginas de vinte em vinte resultados.</p>
<p>Para realizar a coleta, precisamos de duas funções principais, uma que faz a busca e outra que acessa uma página específica (que será executada várias vezes). Utilizaremos as funções <code>cjsg</code> e <code>cjsg_pag</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cjsg &lt;-<span class="st"> </span>function(<span class="dt">parms =</span> <span class="kw">cjsg_parms</span>(), <span class="dt">path =</span> <span class="st">&#39;./cjsg&#39;</span>, 
                 <span class="dt">min_pag =</span> <span class="dv">1</span>, <span class="dt">max_pag =</span> <span class="dv">10</span>, <span class="dt">overwrite =</span> <span class="ot">FALSE</span>,
                 <span class="dt">verbose =</span> <span class="ot">TRUE</span>, <span class="dt">p =</span> .<span class="dv">05</span>) {
  <span class="kw">suppressWarnings</span>(<span class="kw">dir.create</span>(path))
  if (!<span class="kw">file.exists</span>(path)) <span class="kw">stop</span>(<span class="kw">sprintf</span>(<span class="st">&#39;Pasta não &quot;%s&quot; pôde ser criada&#39;</span>, path))
  conf &lt;-<span class="st"> </span>httr::<span class="kw">config</span>(<span class="dt">ssl_verifypeer =</span> <span class="ot">FALSE</span>)
  r0 &lt;-<span class="st"> </span>httr::<span class="kw">POST</span>(<span class="st">&#39;http://esaj.tjsp.jus.br/cjsg/resultadoCompleta.do&#39;</span>, 
                   <span class="dt">body =</span> parms, <span class="dt">config =</span> conf)
  if (<span class="kw">is.na</span>(max_pag) ||<span class="st"> </span><span class="kw">is.infinite</span>(max_pag)) n_pags &lt;-<span class="st"> </span><span class="kw">cjsg_n_pags</span>(r0)
  abjutils::<span class="kw">dvec</span>(cjsg_pag, <span class="dv">1</span>:n_pags, <span class="dt">path =</span> path, <span class="dt">overwrite =</span> overwrite)
}</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cjsg_pag &lt;-<span class="st"> </span>function(pag, path, ow) {
  u &lt;-<span class="st"> &#39;http://esaj.tjsp.jus.br/cjsg/trocaDePagina.do?tipoDeDecisao=A&amp;pagina=%d&#39;</span>
  u_pag &lt;-<span class="st"> </span><span class="kw">sprintf</span>(u, pag)
  arq &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&#39;%s/%05d.html&#39;</span>, path, pag)
  if (!<span class="kw">file.exists</span>(pag) ||<span class="st"> </span>ow) {
    httr::<span class="kw">GET</span>(<span class="kw">sprintf</span>(u, pag), httr::<span class="kw">write_disk</span>(arq, <span class="dt">overwrite =</span> ow))
    tibble::<span class="kw">data_frame</span>(<span class="dt">result =</span> <span class="st">&#39;OK&#39;</span>)
  } else {
    tibble::<span class="kw">data_frame</span>(<span class="dt">result =</span> <span class="st">&#39;já existe&#39;</span>)
  }
}</code></pre></div>
<p>A função <code>search_docs</code> precisa ser capaz de realizar uma pesquisa e retornar a resposta do servidoe que contém a primeira página dos resultados. Para isso, ela recebe uma lista com dados da busca (do formulário) a url base e um método para realizar a requisição, podendo ser ‘get’ ou ‘post’. Caso a pesquisa seja mais complicada, é possível adicionar também uma função que sobrepõe a busca padrão.</p>
<p>É possível visualizar a página baixada com a função <code>BROWSE</code> do pacote <code>httr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">arqs &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="st">&#39;data-raw/cjsg&#39;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)
httr::<span class="kw">BROWSE</span>(arqs[<span class="dv">1</span>])</code></pre></div>
<p><strong>OBS:</strong> A imagem fica “feia” pois está sem a folha de estilos e as imagens.</p>
<p>Note que criamos uma função que facilita a entrada de parâmetros de busca. No nosso exemplo, existem parâmetros necessários na requisição que não precisam ser preenchidos, e parâmetros que precisam ser preenchidos de uma maneira específica, como as datas, que precisam ser inseridas no formato <code>%d/%m/%Y</code>. Assim, incluimos uma função de “ajuda”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cjsg_parms &lt;-<span class="st"> </span>function(<span class="dt">livre =</span> <span class="st">&#39;&#39;</span>, <span class="dt">classes =</span> <span class="st">&#39;&#39;</span>, <span class="dt">assuntos =</span> <span class="st">&#39;&#39;</span>,
                        <span class="dt">data_inicial =</span> <span class="st">&#39;&#39;</span>, <span class="dt">data_final =</span> <span class="st">&#39;&#39;</span>, <span class="dt">varas =</span> <span class="st">&#39;&#39;</span>) {
  classes =<span class="st"> </span><span class="kw">paste0</span>(classes, <span class="dt">collapse =</span> <span class="st">&#39;,&#39;</span>)
  assuntos =<span class="st"> </span><span class="kw">paste0</span>(assuntos, <span class="dt">collapse =</span> <span class="st">&#39;,&#39;</span>)
  varas =<span class="st"> </span><span class="kw">paste0</span>(varas, <span class="dt">collapse =</span> <span class="st">&#39;,&#39;</span>)
  if(data_inicial !=<span class="st"> &#39;&#39;</span> &amp;<span class="st"> </span>data_final !=<span class="st"> &#39;&#39;</span>) {
    <span class="co"># aqui eu uso o pacote lubridate para construir a data no formato</span>
    <span class="co"># que o e-SAJ exige.</span>
    cod_data_inicial &lt;-<span class="st"> </span><span class="kw">paste</span>(lubridate::<span class="kw">day</span>(data_inicial),
                              lubridate::<span class="kw">month</span>(data_inicial),
                              lubridate::<span class="kw">year</span>(data_inicial) ,
                              <span class="dt">sep =</span> <span class="st">&#39;/&#39;</span>)
    cod_data_final &lt;-<span class="st"> </span><span class="kw">paste</span>(lubridate::<span class="kw">day</span>(data_final),
                            lubridate::<span class="kw">month</span>(data_final),
                            lubridate::<span class="kw">year</span>(data_final) ,
                            <span class="dt">sep =</span> <span class="st">&#39;/&#39;</span>)
  }
  parms &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&#39;dadosConsulta.nuProcesso&#39;</span> =<span class="st"> &#39;&#39;</span>,
                <span class="st">&#39;dadosConsulta.pesquisaLivre&#39;</span> =<span class="st"> </span>livre,
                <span class="st">&#39;classeTreeSelection.values&#39;</span> =<span class="st"> </span>classes,
                <span class="st">&#39;assuntoTreeSelection.values&#39;</span> =<span class="st"> </span>assuntos,
                <span class="st">&#39;varasTreeSelection.values&#39;</span> =<span class="st"> </span>varas,
                <span class="st">&#39;dadosConsulta.dtInicio&#39;</span> =<span class="st"> </span>cod_data_inicial,
                <span class="st">&#39;dadosConsulta.dtFim&#39;</span> =<span class="st"> </span>cod_data_final)
  parms
}</code></pre></div>
<p>Também foi necessário realizar um pequeno processamento na primeira requisição, quando o usuário não souber a priori quantas páginas deseja baixar. Nesse caso, a função <code>cjsg_npags</code> identifica o número de paginações necessárias.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cjsg_npags &lt;-<span class="st"> </span>function(req) {
  val &lt;-<span class="st"> </span>xml2::<span class="kw">read_html</span>(httr::<span class="kw">content</span>(req, <span class="st">&#39;text&#39;</span>)) %&gt;%
<span class="st">    </span>xml2::<span class="kw">xml_find_all</span>(<span class="st">&quot;.//*[@id = &#39;resultados&#39;]//td&quot;</span>) %&gt;%
<span class="st">    `</span><span class="dt">[[</span><span class="st">`</span>(<span class="dv">1</span>) %&gt;%
<span class="st">    </span>xml2::<span class="kw">xml_text</span>() %&gt;%
<span class="st">    </span>stringr::<span class="kw">str_trim</span>() %&gt;%
<span class="st">    </span>stringr::<span class="kw">str_match</span>(<span class="st">&#39;de ([0-9]+)&#39;</span>)
  num &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(val[<span class="dv">1</span>, <span class="dv">2</span>])
  num
}</code></pre></div>
<p>A função <code>dvec</code> é uma função genérica que ajuda a aplicar uma função a cada elemento de determinados itens, como um <code>lapply</code>, mas que o faz de forma mais verborrágica e não resulta em erro caso um elemento dê erro.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#&#39; Vetorizando scrapers</span>
<span class="co">#&#39;</span>
<span class="co">#&#39; Vetoriza um scraper (função) para um vetor de itens</span>
<span class="co">#&#39;</span>
<span class="co">#&#39; @param fun função a ser aplicada em cada arquivo.</span>
<span class="co">#&#39; @param itens character vector dos caminhos de arquivos a serem transformados.</span>
<span class="co">#&#39; @param ... outros parâmetros a serem passados para \code{fun}</span>
<span class="co">#&#39; @param verbose se \code{TRUE} (default), mostra o item com probabilidade p.</span>
<span class="co">#&#39; @param p probabilidade de imprimir mensagem.</span>
<span class="co">#&#39; </span>
<span class="co">#&#39; @export</span>
dvec &lt;-<span class="st"> </span>function(fun, itens, ..., <span class="dt">verbose =</span> <span class="ot">TRUE</span>, <span class="dt">p =</span> .<span class="dv">05</span>) {
  f &lt;-<span class="st"> </span>dplyr::<span class="kw">failwith</span>(<span class="kw">data_frame</span>(<span class="dt">result =</span> <span class="st">&#39;erro&#39;</span>), fun)
  tibble::<span class="kw">data_frame</span>(<span class="dt">item =</span> itens) %&gt;%
<span class="st">    </span>dplyr::<span class="kw">distinct</span>(item) %&gt;%
<span class="st">    </span>dplyr::<span class="kw">group_by</span>(item) %&gt;%
<span class="st">    </span>dplyr::<span class="kw">do</span>({
      if (<span class="kw">runif</span>(<span class="dv">1</span>) &lt;<span class="st"> </span>p &amp;&amp;<span class="st"> </span>verbose) <span class="kw">print</span>(.$item)
      d &lt;-<span class="st"> </span><span class="kw">f</span>(.$item, ...)
      if (tibble::<span class="kw">has_name</span>(d, <span class="st">&#39;result&#39;</span>)) d$result &lt;-<span class="st"> &#39;OK&#39;</span>
      d
    }) %&gt;%
<span class="st">    </span>dplyr::<span class="kw">ungroup</span>()
}</code></pre></div>
<p>No trabalho das câmaras, utilizamos a seguinte chamada da função:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d_result &lt;-<span class="st"> </span><span class="kw">cjsg_parms</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">cjsg</span>(<span class="dt">path =</span> <span class="st">&#39;data-raw/cjsg&#39;</span>)</code></pre></div>
<p><strong>Onde guardar os dados?</strong> Ao construir um scraper, é importante guardar os dados brutos na máquina ou num servidor, para reprodutibilidade e manutenção do scraper. Se estiver construindo um pacote do R, o melhor lugar para guardar esses dados é na pasta <code>data-raw</code>, como sugerido no livro <a href="http://r-pkgs.had.co.nz">r-pkgs</a>. Se os dados forem muito volumosos, pode ser necessário colocar esses documentos numa pasta externa ao pacote. Para garantir a reprodutibilidade, recomendamos a criação de um pacote no R cujo objetivo é somente baixar e processar esses dados, além da criação de um repositório na nuvem (Dropbox, por exemplo). No pacote que contém as funções de extração, guarde os dados já processados (se couberem) num arquivo <code>.rda</code> dentro da pasta <code>data</code> do pacote.</p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="web-scraping.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="coletar-processos.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/abjur/curso/edit/master/02-ferramental.Rmd",
"text": "Editar"
},
"download": ["curso-jurimetria.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
